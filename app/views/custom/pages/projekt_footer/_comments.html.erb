<% cache [locale_and_user_status, @current_order, commentable_cache_key(projekt), @comment_tree.comments, @comment_tree.comment_authors, projekt.comments.count, @projekt, @projekt.page, @projekt.projekt_settings] do %>
  <div class="row comments">
    <div id="comments" class="small-12 column">
      <%= render "shared/wide_order_selector", i18n_namespace: "comments", current_tab: '#tab-comments' %>

      <% if user_signed_in? && @projekt.present? && @projekt.comments_allowed?(current_user) %>
        <%= render "comments/form", { commentable: projekt, parent_id: nil } %>

      <% elsif user_signed_in? && @projekt.present? %>

        <div class='callout alert'>

          <% if !current_user.level_two_or_three_verified? %>
            <%= t('custom.comments.restricted.not_verified', verify_account: link_to_verify_account).html_safe %>

          <% elsif !@projekt.current? %>
            <%= t('custom.comments.restricted.projekt_not_active')%>

          <% else %>
            <%= t('custom.comments.restricted.other')%>
          <% end %>

        </div>

      <% elsif user_signed_in? && @projekt.nil? %>
<% byebug %>
        <div class='callout success'>
        <%= t('custom.comments.restricted.other')%>
        </div>

      <% else %>
        <br>
        <%= render "shared/login_to_comment" %>
      <% end %>

      <%= render "comments/comment_list", comments: @comment_tree.root_comments %>
      <%= paginate @comment_tree.root_comments %>
    </div>
  </div>
<% end %>
