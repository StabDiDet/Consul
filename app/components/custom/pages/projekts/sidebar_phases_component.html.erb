<div class="sidebar-divider hide-for-small-only"></div>

<h2 class="sidebar-title hide-for-small-only"><%= t("custom.projekts.page.sidebar.phases.title") %></h2>

<div class='sidebar-projekt-phases'>

  <% if show_cta? %>
    <span class='sidebar-projekt-phases-title'><%= t('custom.projekts.page.sidebar.phases.participate') %></span>
  <% end %>

  <% if projekt.show_start_date_in_frontend? && projekt.total_duration_start.present? %>
    <div class="sidebar-projekt-phase active" >
      <div class='sidebar-projekt-phase-status'>
      </div>
      <div class='sidebar-projekt-phase-details'>
        <span class='sidebar-projekt-phase-name'>
          <%= t('custom.projekts.page.sidebar.projekt_start') %>
        </span>
        <span class='sidebar-projekt-phase-duration'><%= format_date(projekt.total_duration_start) %></span>
      </div>
    </div>
  <% end %>

  <% index = 0 %>

  <% phases.each do |phase | %>
    <% if phase.phase_activated? %>
      <div class="sidebar-projekt-phase <%= 'active' if phase.current? %>" <%= "aria-expanded=true" if phase.name == 'budget_phase' %>>
        <div class='sidebar-projekt-phase-status'>
        </div>
        <div class='sidebar-projekt-phase-details'>
          <span class='sidebar-projekt-phase-name'>
            <%= phase_name(phase) %>

            <% if projekt_feature?(@projekt, 'general.show_projekt_footer') %>
              <%= link_to "/#{params[:id]}/#{phase.name}_footer_tab", class: 'js-sidebar-phase-link', remote: true, data: { index: index - 1 } do %>
                <i class="fas fa-long-arrow-alt-right"></i>
              <% end %>
            <% end %>

          </span>
          <span class='sidebar-projekt-phase-duration'><%= format_date_range(phase.start_date, phase.end_date) %></span>

          <% if phase.name == 'budget_phase' && projekt.budget.present? %>

            <span class='js-icon-toggle-budget-phases toggle-arrow focusable js-prevent-key-scroll'
                  role="button"
                  tabindex="0"
                  aria-expanded="false"
                  aria-label="<%= t('custom.links.projekts_filter.arrow_label') %>" >
            </span>

            <div class='sidebar-projekt-budget-phases'>
              <%= render Pages::Projekts::SidebarBudgetPhasesComponent.new(projekt.budget) %>
            </div>
          <% end %>
        </div>

      </div>
    <% end %>
    <% index += 1 %>
  <% end %>

  <% if projekt.show_end_date_in_frontend? && projekt.total_duration_end.present? %>
    <div class="sidebar-projekt-phase active">
      <div class='sidebar-projekt-phase-status'>
      </div>
      <div class='sidebar-projekt-phase-details'>
        <span class='sidebar-projekt-phase-name'>
          <%= t('custom.projekts.page.sidebar.projekt_end') %>

          <% if projekt_feature?(@projekt, 'general.show_projekt_footer') %>
            <%= link_to "/#{params[:id]}/#{milestone_phase.name}_footer_tab", remote: true, class: 'js-sidebar-phase-link' do %>
              <i class="fas fa-long-arrow-alt-right"></i>
            <% end %>
          <% end %>
        </span>
        <span class='sidebar-projekt-phase-duration'><%= format_date(projekt.total_duration_end) %></span>
      </div>
    </div>
  <% end %>

</div>
