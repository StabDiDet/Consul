/*
  Author    : Michael Janea
  Version   : 1.0
  Author URL  : www.michaeljanea.me
*/

(function($){

  //define plugin
    $.fn.mjAccordion = function(options){

    //extends
    var mjSettings = $.extend({
      duration: 300,
      toggle  : true
    }, options);

    //function
    return this.each(function(){


      // accessibility fix
      $(this).find('.mj_accordion_item').on('keyup', function() {
        if( event.which === 13 && !$(this).hasClass('active') ) { // enter
          $(this).attr('aria-expanded', 'true')
          $(this).addClass('active').siblings('.mj_accordion_content').stop(true, true).slideDown(mjSettings.duration, function() {
            $(this).addClass('active').removeAttr('style');
          });
        } else if ( event.which === 13 ) {
          $(this).attr('aria-expanded', 'false')
          $(this).siblings('.mj_accordion_content').stop(true, true).slideUp(mjSettings.duration, function() {
            $(this).removeClass('active').removeAttr('style').siblings('.mj_accordion_item').removeClass('active');
          });
        }

        if( event.which === 27 && $(this).hasClass('active') ) { // enter
          $(this).attr('aria-expanded', 'false')
          $(this).siblings('.mj_accordion_content').stop(true, true).slideUp(mjSettings.duration, function() {
            $(this).removeClass('active').removeAttr('style').siblings('.mj_accordion_item').removeClass('active');
          });
        }

      });
      // accessibility fix end



      //on item click
      $(this).find('.mj_accordion_item').on('click', function(){

        //if toggle is true
        if(mjSettings.toggle){

          //hidden
          if(!$(this).hasClass('active')){
            $(this).attr('aria-expanded', 'true')

            $(this).addClass('active').siblings('.mj_accordion_content').stop(true, true).slideDown(mjSettings.duration, function(){

              //add active class and remove inline css generated by jquery
              $(this).addClass('active').removeAttr('style');

            });

          //shown
          }else{
            $(this).attr('aria-expanded', 'false')

            $(this).siblings('.mj_accordion_content').stop(true, true).slideUp(mjSettings.duration, function(){

              //remove active class and remove inline css generated by jquery
              $(this).removeClass('active').removeAttr('style').siblings('.mj_accordion_item').removeClass('active');

            });

          }

        //toggle if false
        }else{

          //show content
          $(this).attr('aria-expanded', 'true')
          $(this).addClass('active').siblings('.mj_accordion_content').stop(true, true).slideDown(mjSettings.duration, function(){

            //add active class and remove inline css generated by jquery
            $(this).addClass('active').removeAttr('style');

          });

          //hide all others
          $(this).attr('aria-expanded', 'false')
          $(this).parent().siblings().find('.mj_accordion_content').stop(true, true).slideUp(mjSettings.duration, function(){

            //remove active class and remove inline css generated by jquery
            $(this).removeClass('active').removeAttr('style').siblings('.mj_accordion_item').removeClass('active');

          });

        }

      });

    });

    };

})(jQuery);
